BEGIN;

DROP TABLE IF EXISTS "list", "card", "tag", "label", "card_has_tag", "card_has_label";

CREATE TABLE "list"(
    "id" INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    "name" TEXT NOT NULL,
    "position" INTEGER NOT NULL DEFAULT 0,
    "created_at" TIMESTAMPTZ NOT NULL DEFAULT NOW(),
    "updated_at" TIMESTAMPTZ
);

CREATE TABLE "card"(
    "id" INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    "content" TEXT NOT NULL,
    "position" INTEGER NOT NULL DEFAULT 0,
    "color" TEXT,
    "created_at" TIMESTAMPTZ NOT NULL DEFAULT NOW(),
    "updated_at" TIMESTAMPTZ,
    "list_id" INTEGER NOT NULL REFERENCES "list"("id") ON DELETE CASCADE
);

CREATE TABLE "tag"(
    "id" INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    "name" TEXT NOT NULL,
    "color" TEXT,
    "created_at" TIMESTAMPTZ NOT NULL DEFAULT NOW(),
    "updated_at" TIMESTAMPTZ
);

CREATE TABLE "card_has_tag"(
    "id" INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    "card_id" INTEGER NOT NULL REFERENCES "card" ON DELETE CASCADE,
    "tag_id" INTEGER NOT NULL REFERENCES "tag" ON DELETE CASCADE,
    "created_at" TIMESTAMPTZ NOT NULL DEFAULT NOW()
);

INSERT INTO "list" ("id", "name", "position")
VALUES
(1, 'première liste', 1),
(2, 'deuxième liste', 0)
;

INSERT INTO "card" ("id", "content", "color", "list_id", "position")
VALUES
(1, 'carte 1', '#ff00ff', 1, 1),
(2, 'carte 2', '#00ffff', 1, 0),
(3, 'carte 3', '#ffff00', 2, 0);

INSERT INTO "tag" ("id", "name", "color")
VALUES
(1, 'urgent', '#ff0000'),
(2, 'front', '#0000ff'),
(3, 'back', '#00ff00');

INSERT INTO "card_has_tag" ("card_id", "tag_id")
VALUES
(1, 1),
(1, 3),
(2, 2),
(3, 1),
(3, 3);

SELECT setval('list_id_seq', (SELECT MAX(id) from "list"));
SELECT setval('card_id_seq', (SELECT MAX(id) from "card"));
SELECT setval('tag_id_seq', (SELECT MAX(id) from "tag"));


COMMIT;